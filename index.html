<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUNTIMECHAT</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="loading-screen" class="screen active">
        <div class="logo-pulse">MH</div> <p>Loading FunTimeChat...</p>
    </div>

    <div id="app-container" style="display:none;">

        <header id="topbar">
            <div class="logo">MH</div>
            <h1 id="current-view-title">Welcome</h1>
            <div class="controls">
                <button id="theme-toggle">‚òÄÔ∏è/üåô</button>
                <button id="admin-panel-btn" style="display:none;">üîë</button>
                <img id="user-photo" src="default.png" alt="Profile" class="profile-pic" style="display:none;">
                <button id="signout-btn" style="display:none;">Logout</button>
            </div>
        </header>

        <main id="main-content">
            <div id="auth-view" class="view active">
                <h2>Sign In / Sign Up</h2>
                <div class="auth-card">
                    <button id="google-signin-btn" class="square-btn type-b">Sign in with Google</button>
                    <hr>
                    <input type="email" id="email-input" placeholder="Email">
                    <input type="password" id="password-input" placeholder="Password">
                    <button id="email-signin-btn" class="square-btn type-b">Sign In</button>
                    <button id="email-signup-btn" class="square-btn type-b">Sign Up</button>
                    <button id="forgot-password-btn">Forgot Password?</button>
                    <button id="anonymous-login-btn">Continue as Guest</button>
                </div>
            </div>

            <div id="public-chat-view" class="view" style="display:none;">
                <div class="room-selector">
                    <button class="square-btn type-b active-room">Global Chat</button>
                </div>
                <div id="messages-container" class="message-list-area">
                    </div>
                <div id="typing-indicator" class="typing-status" style="display:none;">Someone is typing...</div>
                <div class="input-area">
                    <input type="text" id="message-input" placeholder="Type a message...">
                    <input type="file" id="file-upload-input" style="display:none;">
                    <button id="upload-file-btn">üìé</button>
                    <button id="send-message-btn" class="square-btn type-b">‚û°Ô∏è</button>
                </div>
            </div>

            <div id="inbox-view" class="view" style="display:none;">
                <button id="back-to-inbox-list" class="square-btn type-b" style="display:none; width:auto; margin-bottom: 10px;">‚Üê Back to Inbox</button>
                <h2 id="inbox-title">Private Messages (Inbox)</h2>
                <div id="chat-list-container" class="message-list-area">
                    <p>Loading your private chats...</p>
                </div>
                <div id="private-chat-room" style="display:none; height:100%; display:flex; flex-direction:column;">
                    <div id="private-messages-container" class="message-list-area" style="flex-grow:1; height: auto;"></div>
                    <div class="input-area">
                        <input type="text" id="private-message-input" placeholder="Type private message...">
                        <button id="private-send-message-btn" class="square-btn type-b">‚û°Ô∏è</button>
                    </div>
                </div>
            </div>

            <div id="random-chat-view" class="view" style="display:none;">
                <h2>Random Chat</h2>
                <p>Click 'Start Match' to find a stranger!</p>
                <button id="start-random-match-btn" class="square-btn type-b">Start Match</button>
            </div>
            <div id="friends-view" class="view" style="display:none;"><h2>Friends & Requests</h2><p>Feature implementation pending...</p></div>
            <div id="admin-view" class="view" style="display:none;"><h2>Admin Panel</h2><p>Feature implementation pending...</p></div>
            
        </main>

        <div id="call-overlay" class="call-ui" style="display:none;">
            <p>Incoming Call...</p>
            <div id="call-controls">
                <button id="accept-call-btn" class="square-btn type-b">‚úÖ Accept</button>
                <button id="reject-call-btn" class="square-btn type-b">‚ùå Reject</button>
            </div>
        </div>

        <nav id="bottom-nav">
            <button data-view="public-chat-view">üí¨ Public</button>
            <button data-view="inbox-view">‚úâÔ∏è Inbox</button>
            <button data-view="random-chat-view">üé≤ Random</button>
            <button data-view="friends-view">üë• Friends</button>
        </nav>

        <footer id="legal-footer">
            <a href="privacy.html">Privacy Policy</a> | <a href="terms.html">Terms</a> | <a href="report.html">Report</a>
        </footer>
    </div>

    <audio id="new-message-sound" src="message.mp3" preload="auto"></audio>
    <audio id="incoming-call-ringtone" src="ringtone.mp3" preload="auto"></audio>

    <script type="module">
        // üö® STEP 1: Firebase Configuration (Your Code)
        const firebaseConfig = {
            apiKey: "AIzaSyB__tJ3sv3cB2N3vKHFCv8SYngJENQxwhY",
            authDomain: "funtimechat69-39947.firebaseapp.com",
            databaseURL: "https://funtimechat69-39947-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "funtimechat69-39947",
            storageBucket: "funtimechat69-39947.firebasestorage.app",
            messagingSenderId: "559638056734",
            appId: "1:559638056734:web:9329d2b561b6fab106830f"
        };

        // üö® STEP 2: Necessary Firebase SDK Imports 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, 
            signOut, signInAnonymously, updateProfile 
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { 
            getDatabase, ref, push, onValue, serverTimestamp, query, limitToLast, set, remove, off, get // 'get' added for fetching latest message/participant info
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // Initialize Firebase Services
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Utility function to switch views
        const handleNavigation = (viewId) => {
            document.querySelectorAll('.view').forEach(view => {
                view.style.display = 'none';
            });
            const newView = document.getElementById(viewId);
            if(newView) {
                newView.style.display = 'block';
                document.getElementById('current-view-title').textContent = newView.querySelector('h2')?.textContent || 'FunTimeChat';
            }
        };

        // ***************************************************************
        // 2. ACCOUNT SYSTEM (AUTHENTICATION) - ACTIVE
        // ***************************************************************

        // Auth State Listener (Handles Login/Logout UI)
        onAuthStateChanged(auth, (user) => {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex'; 

            const userPhotoEl = document.getElementById('user-photo');
            const signoutBtn = document.getElementById('signout-btn');

            if (user) {
                // LOGGED IN
                document.getElementById('auth-view').style.display = 'none';
                userPhotoEl.style.display = 'block';
                signoutBtn.style.display = 'block';

                userPhotoEl.src = user.photoURL || 'default.png';
                
                if(document.getElementById('public-chat-view').style.display === 'none' && document.getElementById('auth-view').style.display === 'block') {
                    handleNavigation('public-chat-view');
                }
                
                // NEW: Load Private Chat List when logged in
                loadChatList();
            } else {
                // LOGGED OUT
                document.getElementById('auth-view').style.display = 'block';
                userPhotoEl.style.display = 'none';
                signoutBtn.style.display = 'none';
                
                handleNavigation('auth-view');
            }
        });
        
        // Google Sign-in
        document.getElementById('google-signin-btn').addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert("Google Sign-in failed: " + error.message);
            }
        });
        
        // Email/Password Sign-up
        document.getElementById('email-signup-btn').addEventListener('click', async () => {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: email.split('@')[0] }); 
                alert("Sign Up successful! Logged in.");
            } catch (error) {
                alert("Sign Up failed: " + error.message);
            }
        });

        // Email/Password Sign-in
        document.getElementById('email-signin-btn').addEventListener('click', async () => {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                alert("Sign In successful!");
            } catch (error) {
                alert("Sign In failed: " + error.message);
            }
        });

        // Anonymous Login
        document.getElementById('anonymous-login-btn').addEventListener('click', async () => {
            try {
                await signInAnonymously(auth);
                alert("Signed in as Guest.");
            } catch (error) {
                alert("Anonymous Sign-in failed: " + error.message);
            }
        });

        // Forgot Password
        document.getElementById('forgot-password-btn').addEventListener('click', async () => {
            const email = document.getElementById('email-input').value;
            if (email) {
                try {
                    await sendPasswordResetEmail(auth, email);
                    alert("Password reset email sent!");
                } catch (error) {
                    alert("Error sending reset email: " + error.message);
                }
            } else {
                alert("Please enter your email in the field above.");
            }
        });
        
        // Logout Button
        document.getElementById('signout-btn').addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Logout Error:", error);
            }
        });

        // ***************************************************************
        // 3. PUBLIC CHAT SYSTEM (ACTIVE SEND/RECEIVE + SEEN TICKS)
        // ***************************************************************

        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message-btn');
        const messagesRef = ref(db, 'public_rooms/global/messages');
        const recentMessagesQuery = query(messagesRef, limitToLast(100)); 

        // üí° FUNCTION: ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á (Seen) ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ö‡§ø‡§π‡•ç‡§®‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ
        const updateMessageSeenStatus = (messageKey, roomType, chatID) => {
            const currentUser = auth.currentUser;
            if (!currentUser) return;

            const path = roomType === 'public' 
                ? `public_rooms/global/messages/${messageKey}/reads/${currentUser.uid}`
                : `private_chats/${chatID}/messages/${messageKey}/reads/${currentUser.uid}`;
                
            set(ref(db, path), true)
                .catch(error => console.error("Error setting seen status:", error));
        };
        
        // Helper function to render messages (used by both Public and Private Chat)
        const renderMessage = (message, key, roomType, chatID, container) => {
            const currentUserUid = auth.currentUser?.uid;
            
            // --- SEEN LOGIC CALCULATION (Simplified for clarity) ---
            const reads = message.reads || {};
            const allUids = Object.keys(reads);
            
            let seenStatus = 'delivered'; 
            let seenCount = allUids.length - 1; 

            if (message.uid === currentUserUid) {
                if (seenCount >= 1) {
                    seenStatus = 'seen'; 
                } 
            } else {
                seenStatus = 'received';
                if (!reads[currentUserUid]) {
                    setTimeout(() => updateMessageSeenStatus(key, roomType, chatID), 500);
                }
            }
            // ----------------------------------------------------

            const messageElement = document.createElement('div');
            messageElement.className = `message-card ${seenStatus}`; 
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="user-name">${message.displayName || 'Anonymous'}</span>
                    <span class="timestamp">${new Date(message.timestamp).toLocaleTimeString()}</span>
                </div>
                <p class="message-text">${message.text}</p>
                <div class="message-status-ticks">
                    ${message.uid === currentUserUid ? (seenStatus === 'seen' ? '‚úîÔ∏è‚úîÔ∏è' : '‚úîÔ∏è') : ''}
                </div>
            `;
            messageElement.dataset.key = key; 
            container.appendChild(messageElement);
        };


        // Sending Message Logic (Public Chat)
        sendMessageBtn.addEventListener('click', async () => {
            const messageText = messageInput.value.trim();
            const currentUser = auth.currentUser;

            if (messageText && currentUser) {
                const initialReads = {};
                initialReads[currentUser.uid] = true; 

                try {
                    await push(messagesRef, {
                        uid: currentUser.uid,
                        displayName: currentUser.displayName || 'Guest',
                        text: messageText,
                        timestamp: serverTimestamp(),
                        reads: initialReads, 
                    });
                    messageInput.value = ''; 
                    document.getElementById('new-message-sound').play(); 
                } catch (e) {
                    console.error("Error sending message: ", e);
                }
            }
        });

        // Receiving Messages Logic (Public Chat)
        onValue(recentMessagesQuery, (snapshot) => {
            messagesContainer.innerHTML = ''; 
            snapshot.forEach((childSnapshot) => {
                renderMessage(childSnapshot.val(), childSnapshot.key, 'public', null, messagesContainer);
            });
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        });
        
        // ***************************************************************
        // 4. PRIVATE CHAT (INBOX) SYSTEM (NEW ACTIVE LOGIC)
        // ***************************************************************
        
        const chatListContainer = document.getElementById('chat-list-container');
        const privateMessagesContainer = document.getElementById('private-messages-container');
        const privateMessageInput = document.getElementById('private-message-input');
        const privateSendMessageBtn = document.getElementById('private-send-message-btn');
        const backToInboxBtn = document.getElementById('back-to-inbox-list');
        const privateChatRoom = document.getElementById('private-chat-room');
        
        let currentChatID = null; // Stores the ID of the currently open private chat
        let privateMessageListener = null; // Stores the active listener for the private chat room

        // üí° FUNCTION: Private Chat List ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
        const loadChatList = () => {
            if (!auth.currentUser) return;
            const chatsRef = ref(db, 'private_chats');

            // List of all private chats
            onValue(chatsRef, async (snapshot) => {
                chatListContainer.innerHTML = '';
                let hasChats = false;

                snapshot.forEach(async (childSnapshot) => {
                    const chat = childSnapshot.val();
                    const chatID = childSnapshot.key;
                    
                    // Filter: Only show chats where the current user is a participant
                    if (chat.participants && chat.participants[auth.currentUser.uid]) {
                        hasChats = true;
                        
                        // Determine the name of the conversation partner
                        const otherUid = Object.keys(chat.participants).find(uid => uid !== auth.currentUser.uid);
                        const otherDisplayName = chat.participants[otherUid]?.displayName || 'Stranger';
                        
                        // Fetch the last message for display
                        const lastMessageSnapshot = await get(query(ref(db, `private_chats/${chatID}/messages`), limitToLast(1)));
                        let lastMessageText = 'Start chatting!';
                        
                        lastMessageSnapshot.forEach(msgSnap => {
                            lastMessageText = msgSnap.val().text;
                        });

                        const chatItem = document.createElement('div');
                        chatItem.className = 'chat-list-item'; // You might need CSS for this class
                        chatItem.dataset.chatID = chatID;
                        chatItem.dataset.otherName = otherDisplayName;
                        chatItem.innerHTML = `
                            <h3>${otherDisplayName}</h3>
                            <p>${lastMessageText.substring(0, 30)}...</p>
                            <span class="chat-time">${new Date(chat.createdAt).toLocaleDateString()}</span>
                        `;
                        
                        // Add click handler to open the specific chat
                        chatItem.addEventListener('click', () => openPrivateChat(chatID, otherDisplayName));
                        
                        chatListContainer.appendChild(chatItem);
                    }
                });
                
                if (!hasChats) {
                    chatListContainer.innerHTML = '<p>Your inbox is empty. Try starting a Random Chat!</p>';
                }
            });
        };

        // üí° FUNCTION: ‡§è‡§ï ‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§ö‡•à‡§ü ‡§∞‡•Ç‡§Æ ‡§ñ‡•ã‡§≤‡§®‡§æ
        const openPrivateChat = (chatID, otherName) => {
            currentChatID = chatID;
            
            // UI Switch: Hide list, show room
            document.getElementById('inbox-title').textContent = `Chatting with ${otherName}`;
            chatListContainer.style.display = 'none';
            privateChatRoom.style.display = 'flex';
            backToInboxBtn.style.display = 'block';
            
            privateMessagesContainer.innerHTML = ''; // Clear previous messages
            
            // Remove previous listener if active
            if (privateMessageListener) {
                off(privateMessageListener);
            }

            // Start new listener for the specific chat room
            const messagesRef = ref(db, `private_chats/${chatID}/messages`);
            const recentMessagesQuery = query(messagesRef, limitToLast(100)); 

            privateMessageListener = onValue(recentMessagesQuery, (snapshot) => {
                privateMessagesContainer.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    renderMessage(childSnapshot.val(), childSnapshot.key, 'private', chatID, privateMessagesContainer);
                });
                privateMessagesContainer.scrollTop = privateMessagesContainer.scrollHeight;
            });
        };

        // üí° EVENT: ‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡§®‡§æ
        privateSendMessageBtn.addEventListener('click', async () => {
            const messageText = privateMessageInput.value.trim();
            const currentUser = auth.currentUser;

            if (messageText && currentUser && currentChatID) {
                const messagesRef = ref(db, `private_chats/${currentChatID}/messages`);
                const initialReads = {};
                initialReads[currentUser.uid] = true; 

                try {
                    await push(messagesRef, {
                        uid: currentUser.uid,
                        displayName: currentUser.displayName || 'User',
                        text: messageText,
                        timestamp: serverTimestamp(),
                        reads: initialReads, 
                    });
                    privateMessageInput.value = ''; 
                    document.getElementById('new-message-sound').play(); 
                } catch (e) {
                    console.error("Error sending private message: ", e);
                }
            }
        });

        // üí° EVENT: Inbox List ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§®‡§æ
        backToInboxBtn.addEventListener('click', () => {
            currentChatID = null;
            if (privateMessageListener) {
                off(privateMessageListener); // Stop listening to the private room
            }
            
            // UI Switch: Hide room, show list
            document.getElementById('inbox-title').textContent = 'Private Messages (Inbox)';
            chatListContainer.style.display = 'block';
            privateChatRoom.style.display = 'none';
            backToInboxBtn.style.display = 'none';
        });

        // ***************************************************************
        // 5. RANDOM CHAT SYSTEM (ACTIVE LOGIC)
        // ***************************************************************
        // (This section is copied from the previous successful code)

        const randomChatBtn = document.querySelector('#bottom-nav button[data-view="random-chat-view"]');
        const randomChatView = document.getElementById('random-chat-view');
        let currentMatchListener = null; 

        // üí° FUNCTION: ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§æ‡§á‡§µ‡•á‡§ü ‡§ö‡•à‡§ü ‡§∞‡•Ç‡§Æ ‡§¨‡§®‡§æ‡§®‡§æ
        const createNewRandomChat = (user1Uid, user2Uid) => {
            const chatID = [user1Uid, user2Uid].sort().join('_');
            const chatRef = ref(db, `private_chats/${chatID}`);
            
            // Get other user's display name from the queue (for better display)
            const queueRef = ref(db, 'matchQueue');
            get(ref(db, `matchQueue/${user2Uid}`)).then((snapshot) => {
                const otherDisplayName = snapshot.val()?.displayName || 'Stranger';

                set(chatRef, {
                    participants: {
                        [user1Uid]: { displayName: auth.currentUser.displayName || 'User' },
                        [user2Uid]: { displayName: otherDisplayName } 
                    },
                    status: 'active',
                    createdAt: serverTimestamp()
                })
                .then(() => {
                    alert(`Match Found! You are now connected with ${otherDisplayName}. Check your Inbox.`);
                    randomChatView.innerHTML = `<h2>Random Chat</h2><p>Match Found with ${otherDisplayName}! Go to your Inbox to start chatting.</p><button id="start-random-match-btn" class="square-btn type-b">Start New Match</button>`;
                    handleNavigation('inbox-view'); // Inbox ‡§™‡§∞ ‡§∞‡•Ä‡§°‡§æ‡§Ø‡§∞‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç
                    loadChatList(); // Inbox List ‡§ï‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                })
                .catch(error => console.error("Error creating chat:", error));
                
                // Queue ‡§∏‡•á ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç 
                remove(ref(db, `matchQueue/${user1Uid}`));
                remove(ref(db, `matchQueue/${user2Uid}`));
            });
        };


        // üí° FUNCTION: ‡§Æ‡•à‡§ö Queue ‡§Æ‡•á‡§Ç ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ï‡•ã ‡§°‡§æ‡§≤‡§®‡§æ ‡§î‡§∞ ‡§Æ‡•à‡§ö ‡§¢‡•Ç‡§Å‡§¢‡§®‡§æ
        const startRandomMatchmaking = async () => {
            const currentUser = auth.currentUser;
            if (!currentUser || currentUser.isAnonymous) {
                alert("Please sign in with a permanent account to start Random Chat.");
                return;
            }

            randomChatView.innerHTML = `<h2>Searching for a Match...</h2><p>Please wait while we connect you with a stranger.</p><button id="cancel-match-btn" class="square-btn type-b">Cancel Matchmaking</button>`;
            handleNavigation('random-chat-view');

            const queueRef = ref(db, 'matchQueue');

            await set(ref(db, `matchQueue/${currentUser.uid}`), {
                displayName: currentUser.displayName || 'Stranger',
                timestamp: serverTimestamp()
            });
            
            document.getElementById('cancel-match-btn').addEventListener('click', () => {
                remove(ref(db, `matchQueue/${currentUser.uid}`));
                if (currentMatchListener) {
                    off(currentMatchListener); 
                }
                randomChatView.innerHTML = `<h2>Random Chat</h2><p>Matchmaking cancelled. Click 'Start Match' to try again.</p><button id="start-random-match-btn" class="square-btn type-b">Start Match</button>`;
                document.getElementById('start-random-match-btn').addEventListener('click', startRandomMatchmaking);
            });

            const findMatch = onValue(queueRef, (snapshot) => {
                const queue = snapshot.val();
                if (!queue) return;
                
                const uidsInQueue = Object.keys(queue);
                
                if (uidsInQueue.length >= 2) {
                    const potentialMatchUid = uidsInQueue.find(uid => uid !== currentUser.uid);

                    if (potentialMatchUid) {
                        off(findMatch);
                        createNewRandomChat(currentUser.uid, potentialMatchUid);
                    }
                }
            });

            currentMatchListener = findMatch; 
        };

        // 5. Bottom Nav Button ‡§î‡§∞ Start Match ‡§¨‡§ü‡§® ‡§™‡§∞ Listener ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
        randomChatBtn.addEventListener('click', () => {
            if (auth.currentUser) {
                startRandomMatchmaking();
            } else {
                alert("Please sign in to use Random Chat.");
                handleNavigation('auth-view');
            }
        });

        document.getElementById('random-chat-view').addEventListener('click', (e) => {
            if (e.target.id === 'start-random-match-btn') {
                startRandomMatchmaking();
            }
        });
        
        // ***************************************************************
        // UI AND NAVIGATION (Point 1)
        // ***************************************************************

        // Bottom Navigation Handler
        document.getElementById('bottom-nav').addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.view) {
                if (auth.currentUser || e.target.dataset.view === 'auth-view') {
                    handleNavigation(e.target.dataset.view);
                } else {
                    alert("Please sign in first!");
                }
            }
        });
        
        // Dark/Light Toggle Placeholder
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });
    </script>
</body>
</html>
